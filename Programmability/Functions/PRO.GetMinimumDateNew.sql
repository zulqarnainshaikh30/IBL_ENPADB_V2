SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO




CREATE FUNCTION [PRO].[GetMinimumDateNew]
(

@DATE date,
@DATE1 date ,
@DATE2 date,
@DATE3 date
)
returns date
as
begin

SET @DATE=CASE WHEN @DATE IN('1900-01-01','2099-01-01')   THEN NULL ELSE @DATE END
SET @DATE1=CASE WHEN @DATE1 IN('1900-01-01','2099-01-01')  THEN NULL ELSE @DATE1 END
SET @DATE2=CASE WHEN @DATE2 IN('1900-01-01','2099-01-01')   THEN NULL ELSE @DATE2 END
SET @DATE3=CASE WHEN @DATE3 IN('1900-01-01','2099-01-01')   THEN NULL ELSE @DATE3 END
return(

SELECT CASE WHEN  ISNULL(@DATE,'9999-01-01')<= ISNULL(@DATE1,'9999-01-01')
                     AND ISNULL(@DATE,'9999-01-01')<=ISNULL(@DATE2,'9999-01-01')
					 AND ISNULL(@DATE,'9999-01-01')<=ISNULL(@DATE3,'9999-01-01')  
					 THEN @DATE
            WHEN ISNULL(@DATE1,'9999-01-01')<= ISNULL(@DATE,'9999-01-01')
                     AND ISNULL(@DATE1,'9999-01-01')<=ISNULL(@DATE2,'9999-01-01') 
					 AND ISNULL(@DATE1,'9999-01-01')<=ISNULL(@DATE3,'9999-01-01')
					 THEN @DATE1
			WHEN ISNULL(@DATE2,'9999-01-01')<= ISNULL(@DATE,'9999-01-01')
                     AND ISNULL(@DATE2,'9999-01-01')<=ISNULL(@DATE1,'9999-01-01')
					 AND ISNULL(@DATE2,'9999-01-01')<=ISNULL(@DATE3,'9999-01-01')
					  THEN @DATE2
           
		 ELSE NULL END)
 end



GO